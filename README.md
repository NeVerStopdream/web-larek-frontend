# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Типы данных

interface IAppState - Приложение

```
    catalog: IProduct[];
    preview: string | null;
    delivery: IDeliveryForm | null;
    basket: IProduct[];
    contact: IContactForm| null;
    order: IOrder| null;
```

interface IActions - Пользовательские действия

```
    onClick: (event: MouseEvent) => void; 
```

interface ISuccessActions - Успешное действие

```
    onClick: ()  => void;
```

interface IDeliveryForm - Информация о доставке товара

```
    payment: string;
    address: string;
```

interface IContactForm  - Информация о покупателе

```
    email: string;
    phone: string;
```

interface IOrder extends IDeliveryForm, IContactForm - Информация о заказе

```
    total: number;
    items: string[];
```

interface IOrderResult - Ответ от сервера о заказе

```
    id: string;
    total: number;
```

interface IPage - главная страница

```
    counter: number;
    catalog: HTMLElement[];
```

interface ICardItem - Информация о товарах

```
    id: string;
    title: string;
    price: number | null;
    image: string;
    description: string;
    category: string;
```

interface ICard extends IProduct - Отображение карточки товара

```
    index?: string;
    buttonTitle?: string;
```

interface IModalData - Товар в модальном окне 

```
    content: HTMLElement;
```

interface IFormState - Форма

```
    valid: boolean;
    errors: string[];
```

interface IBasketView - Отображение корзины товаров

```
    items: HTMLElement[];
    total: number;
```

interface ISuccess - Отображения успешного заказа

```
    total: number; // Общая стоимость заказа
```

interface IFormState - Состояние формы

```
    valid: boolean;
    errors: string[];
```

type FormErrors Ошибка формы

```
export type FormErrors = Partial<Record<keyof IOrder, string>>;

```
## Архитектура приложения

Структура проекта:

- слой отображения (все что отвечает за вывод информации пользователю);
- слой данных (вся логика приложения без интерфейса);
- presenter (связывает данные и отобрадение);

## Описание базовых классов

### Класс Api
Базовая функциональность для работы с API

Методы:
- handleResponse - метод, обрабатывающий полученный ответ от сервера. Если ответ положительный (response.ok) - возвращает содержимое ответа в виде JSON, иначе возвращает содержимое ошибки;
- get - отправляет запрос с данными и возвращает ответ сервера в виде промиса с объектом;
- post - принимает объект с данными, обрабатывает и отправляет их как параметр при вызове метода;

Конструктор:
- baseUrl: string - URL основного API;
- options: RequestInit = {} - дополнительные параметры для HTTP-запросов;


### Класс EventEmitter
Реализует паттерн "Observer/Наблюдатель"

Методы:
- on - устанавливает обработчик для указанного события;
- off - удаляет обработчик для указанного события;
- emit - вызывает событие с указанными данными;
- onAll - устанавливает обработчик для всех событий;
- offAll - удаляет все слушатели событий;
- trigger - создает слушатель событие с заданными аргументами;

Конструктор:
- constructor() - создает _events, представляющую собой карту событий;

### Класс Component
Абстрактный класс, создает компоненты подьзовательского интерфейса

Методы:
- toggleClass - переключает класс;
- protected setText - устанавливает текстовое содержимое;
- setDisabled - изменяет состояние блокировки;
- protected setHidden - скрывает элемент;
- protected setVisible - показывает элемент;
- protected setImage - установить изображение с алтернативным текстом;
- render - возвращает DOM-элемент;

Конструктор:
- constructor(container: HTMLElement) - контейнер, который является корневым DOM-элементом, в который будет вставлен компонент

### Класс Model
Абстрактный класс, создает модальные окна

Методы:
- emitChanges - событие с названием и данными;

Конструктор:
- constructor(data: Partial, protected events: IEvents) - конструктор принимает данные модели и объект событий, копирует данные в модель


### Класс LarekApi
Класс получает данные с сервера и передает их, наследуя функционал базового класса API

Методы:
- getProductList - получение списка продуктов с сервера;
- getProductItem - получение информации о продукте по его ID;
- orderProducts - отправляет информацию о заказе на сервер и получает результат;


### Класс AppState
Главная модель управления проектом. Наследуется от класса Model

Методы:
- getCounter - возвращает количество товаров в корзине;
- getSumAll - вывод суммы синапсов всех товаров в корзине;
- clearBasket - очищает товары в корзине;
- clearOrder - очищает данные заказа;
- setCatalog - формирует каталог продуктов, преобразуя каждый элемент в экземпляр Product;
- setPreview - предпросомотр продукта;
- addToBasket - добавляет товар в корзину;
- removeFromBasket - удаляет товар из корзины;
- updateBasket - обновляет состояние корзины;
- setDeliveryField - устанавливает значения в данные доставки;
- setContactField - устанавливает значения в данные контактов заказа;
- validateDelivery - проверяет значения данных доставки;
- validateContact - проверяет значения данных контактов;

Конструктор:
- constructor() - конструктор наследуется от класса Model

### Класс Modal
Класс управляет отображением модальных окон

Методы:
- openModal - открывает модальное окон;
- closeModal - закрывает модальное окно;
- content - содержимое модального окна;
- render - отображает модальное окно с контентом и открывает его;

Конструктор:
- constructor(selector: string, events: IEvents) - принимает селектор по которому в разметке страницы будет установлено модальное окно и экземпляр класса EventEmitter для возможности инициализации событий

### Класс Form
Класс создает формы, обрабатывает события ввода формы и отправки формы. Наследуется от Component

Методы:
- onInputChange - обработчик событий ввода формы;
- set valid - контролирует кнопку отправки в зависимости от валидности формы;
- set errors - отвечает за ошибки валидации формы;
- render - отображает состояние формы;

Конструктор:
- constructor(protected container: HTMLFormElement, protected events: IEvents) - принимает контейнер с элементами формы, объект событий, используемый для всех полей ввода и кнопки отправки формы

### Класс Card
Реализует интерфейс ICardItem, отображает карточки товара. Наследуется от Component

Методы:
- set id - устанавливает идентификатор товара;
- set category - устанавливает категорию товара и добавляет соответствующий класс к элементу категории;
- set title - устанавливает название товара;
- set description - устанавливает описание карточки;
- set image - устанавливает изображение карточки;
- set price - устанавливает цену карточки и, если цена установлена, отключает кнопку карточки;
- inBasket - устанавливает, находится ли карточка в корзине, и, если нет, отключает кнопку карточки;

Конструктор:
- constructor(container: HTMLElement, actions?: ICardActions) - принимает контейнер для карточки и объект действий. В конструкторе устанавливаются обработчики событий для категории, заголовка, описания, кнопки, стоимости.


### Класс Basket
Класс управляет отображением корзины товаров

Методы:
- toggleButton - отображает или отключает кнопку оформления заказа в зависимости от наличия товаров в корзине;
- set items - добавляет товары в корзине;
- set total - добавляет и отображает сумму товаров в корзине;

Конструктор:
- constructor(container: HTMLElement, protected events: EventEmitter) - принимает корневой элемент для корзины и объект событий

### Класс DeliveryForm
Класс наследуется от Form

Методы:
- toggleButtons - переключает состояние кнопок способа оплаты;
- set address - устанавливает адрес доставки;

Конструктор:
- constructor(container: HTMLFormElement, events: IEvents) - принимает элементы оплаты, контактные данные пользователя, объект событий;

### Класс Success
Класс необходим для реализации модального окна успешного офомления заказа

Методы:
- set result - устанавливает сообщение об успешной оплате
- set total - устанавливает общую стоимость товаров в корзине;

Конструктор:
- constructor(container: HTMLElement, actions: ISuccessActions) - принимает элемент успешной оплаты и устанавливает обработчик события для кнопки закрытия


## Взаимодействие компонентов

Код взаимодействия представления и данных между собой находится в файле index.ts, выполняет роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера и обработчиков этих событий, описанных в index.ts
В index.ts создаются экземпляры всех классов, далее настраивается обработка событий.